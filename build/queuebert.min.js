if(typeof(Queuebert)==="undefined"){Queuebert={}}(function(){function a(b){var c=b||{};this.delegate=c.delegate||{};this.identifier=c.identifier;this.messageInterval=c.messageInterval||150;this.sendRequest=c.sendRequest||chrome.extension.sendRequest;if(c.start===undefined||c.start){this.start()}}a.prototype.start=function(){var b=this;setInterval(function(){b.sendRequest({from:b.identifier,type:"get"},function(c){if(c){b.handleMessage(c.action,c.from,c.tabId,c.body,c.callback)}})},this.messageInterval)};a.prototype.handleMessage=function(e,c,d,b,f){if(this.delegate[e]){this.delegate[e](c,d,b,f)}};a.prototype.sendMessage=function(c,d){var b={tabId:c.tabId,to:c.to,from:this.identifier,action:c.action,type:"put",body:c.body};d?this.sendRequest(b,d):this.sendRequest(b)};Queuebert.Client=a})();if(typeof(exports)!=="undefined"){exports.Client=Queuebert.Client}if(typeof(Queuebert)==="undefined"){Queuebert={}}(function(){function a(b){var d=this,c=b||{};this.messages={};this.maxQueueSize=c.maxQueueSize||128;this.onRequest=c.onRequest||chrome.extension.onRequest;this.onRequest.addListener(function(f,e,g){d.handleMessage(f,e,g)})}a.prototype.handleMessage=function(f,d,h){var b=h||function(){},c=f.tabId||this.getTabId(d);this.registerClient(f.to,c);this.registerClient(f.from,c);if(f.type=="put"){var e={from:f.from,action:f.action,body:f.body,tabId:this.getTabId(d)};if(h){e.callback=h}this.messages[c][f.to].push(e);if(this.messages[c][f.to].length>this.maxQueueSize){this.messages[c][f.to].shift()}}else{if(f.type=="get"){var g=this.messages[c][f.from].shift();if(g){b(g)}else{b(null)}}}};a.prototype.registerClient=function(c,b){if(typeof(this.messages[b])!=="object"){this.messages[b]={}}if(typeof(this.messages[b][c])==="object"){return}this.messages[b][c]=[]};a.prototype.getTabId=function(b){return"tab_"+b.tab.id};Queuebert.Server=a})();if(typeof(exports)!=="undefined"){exports.Server=Queuebert.Server}if(typeof(Queuebert)==="undefined"){Queuebert={}}if(typeof(require)!=="undefined"&&typeof(exports)!=="undefined"){Queuebert.Client=require("./client").Client}(function(){function b(c){var d=c||{},e=this;this.delegate=d.delegate||{};this.identifier=d.identifier||"background";this.server=d.server;this.messageInterval=d.messageInterval||150;this.sendRequest=function(f,g){if(f.type=="get"){f.tabId="background"}e.server.handleMessage(f,{tab:{id:"background"}},g)};if(d.start===undefined||d.start){this.start()}}for(var a in Queuebert.Client.prototype){b.prototype[a]=Queuebert.Client.prototype[a]}Queuebert.BackgroundClient=b})();if(typeof(exports)!=="undefined"){exports.BackgroundClient=Queuebert.BackgroundClient};